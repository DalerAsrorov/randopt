<!DOCTYPE html>
<html lang="en">
    <head>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="https://cdn.plot.ly/plotly-latest.min.js"></script>

        <title>Randopt Visualization</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css">

        <!-- Tabler Bootstrap -->
        <link rel="stylesheet" href="https://tabler.github.io/tabler/assets/css/dashboard.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

        <!-- AngularJS 1.x -->
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.1/angular.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.1/angular-route.min.js"></script>

        <!-- ag-Grid -->
        <script src="https://unpkg.com/ag-grid@18.1.1/dist/ag-grid.min.js"></script>


        <!-- Custom Styles -->
        <style>
            .code {
                background-color: #fdf6e3;
                padding: 1em;
                margin: .5em 0;
                overflow: auto;
                border-radius: 0.3em;
                color: #657b83;
                font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
                text-align: left;
                white-space: pre;
                word-spacing: normal;
                word-break: normal;
                word-wrap: normal;
                line-height: 1.5;
                -moz-tab-size: 4;
                -o-tab-size: 4;
                tab-size: 4;
                -webkit-hyphens: none;
                -moz-hyphens: none;
                -ms-hyphens: none;
                hyphens: none;
            }

            .away {
                position:absolute;
                left:-9999px;           
                top: -1000px;
            }

            .print-page-break { display: none; }


            .plot-selected {
                border-color:orange;
            }

            /* Chrome, Safari and Opera syntax */
            :-webkit-full-screen .header {
                display:none !important;
            }

            /* Firefox syntax */
            :-moz-full-screen .header {
                display:none !important;
            }

            /* IE/Edge syntax */
            :-ms-fullscreen .header {
                display:none !important;
            }

            /* Standard syntax */
            :fullscreen .header {
                display:none !important;
            }


            @media print {

                @page { size: auto;  margin: 0mm; }

                body {
                    text-align: center;
                    margin: 0;
                    padding: 0 !important;
                    width: 1024px;
                }

                .container, .print-plot-width {
                    text-align: center !important;
                    width: 926px !important;
                }

                .print-page-break {
                    display: block;
                    width: 500px;
                    height: 125px;
                    page-break-after: always;
                }

                body {
                    font-size: 12px;
                }

                .noprint,
                div.alert,
                header,
                .group-media,
                .btn,
                .footer,
                form,
                #comments,
                .nav,
                ul.links.list-inline,
                ul.action-links {
                    display:none !important;
                }
            }

        </style>
    </head>
    <body ng-app="rovizApp">

        <div ng-controller="RovizController as roviz">


            <!-- First line of Header-->
            <div class="header py-4">
                <div class="container">
                    <div class="d-flex">
                        <a class="header-brand" href="./index.html">
                            <img src="https://seba-1511.github.io/randopt/assets/images/logo.png" class="header-brand-img" alt="randopt logo">
                        </a>

                        <!-- Randopt Link -->
                        <div class="d-flex order-lg-2 ml-auto">
                            <div class="nav-item d-none d-md-flex">
                                <a href="https://github.com/seba-1511/randopt" class="btn btn-sm btn-outline-info" target="_blank">
                                    <i class="fa fa-github"></i>
                                    GitHub
                                </a>
                            </div>
                            <div class="nav-item d-none d-md-flex">
                                <a href="https://randopt.ml" class="btn btn-sm btn-outline-info" target="_blank">
                                    <i class="fe fe-download-cloud"></i>
                                    Get Randopt!
                                </a>
                            </div>
                        </div>

                        <!-- Menu button for mobile -->
                        <a href="#" class="header-toggler d-lg-none ml-3 ml-lg-0" data-toggle="collapse" data-target="#headerMenuCollapse">
                            <span class="header-toggler-icon"></span>
                        </a>

                    </div>
                </div>
            </div>

            <!-- Second line of Header -->
            <div class="header collapse d-lg-flex p-0" id="headerMenuCollapse">
                <div class="container">
                    <div class="row align-items-center">

                        <div class="col-lg order-lg-first">
                            <ul class="nav nav-tabs border-0 flex-column flex-lg-row">
                                <li class="nav-item">
                                    <a ng-click="page = 'home'" class="nav-link" ng-class="{'active': page == 'home'}">
                                        <i class="fe fe-home"></i> 
                                        Home
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a ng-click="page = 'data'" class="nav-link" ng-class="{'active': page == 'data'}">
                                        <i class="fe fe-box"></i> 
                                        Data &nbsp;
                                        <small class="">({{roviz.data.length}})</small>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a ng-click="page = 'plots'" class="nav-link" ng-class="{'active': page == 'plots'}">
                                        <i class="fa fa-line-chart"></i>
                                        Plots &nbsp;
                                        <small class="">({{roviz.plots.length}})</small>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a href="https://github.com/seba-1511/randopt/wiki" target="_blank" class="nav-link"><i class="fe fe-file-text"></i> Documentation</a>
                                </li>
                            </ul>
                        </div>
                        <div class="col-md-3 text-right">
                            <a class="btn btn-info" style="color:white;" ng-click="roviz.export();">
                                <i class="fe fe-share-2"></i>
                                Share this page
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Home Page -->
            <div ng-show="page == 'home'" class="container">
                <br />
                <h3>Home</h3>

                <div class="offset-md-2 col-md-8 card">
                    <h3 style="margin-top:10px;">Keyboard Shortcuts</h3> 

                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th scope="col">Command</th>
                                <th scope="col">Mapping</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <th>Shift + ?</th>
                                <td>Go to Home Tab</td>
                            </tr>
                            <tr>
                                <th>Shift + D</th>
                                <td>Go to Data Tab</td>
                            </tr>
                            <tr>
                                <th>Shift + P</th>
                                <td>Go to Plots Tab</td>
                            </tr>
                            <tr>
                                <th>Shift + H / L</th>
                                <td>Go to Previous / Next Tab</td>
                            </tr>
                            <tr>
                                <th>J / K</th>
                                <td>Scroll Down/Up</td>
                            </tr>
                            <tr>
                                <th>F</th>
                                <td>Fullscreen</td>
                            </tr>
                        </tbody>
                    </table>

                </div>
            </div>


            <!-- Data Page -->
            <div ng-show="page == 'data'" class="container" style="height:100%;">

                <br />
                <h3>Data <small>{{roviz.data.length}} summaries</small></h3>

                <div class="col-md-12 card">
                    <div class="row" style="margin:10px;">
                        <div class="col-md-3">
                            <form ng-submit="roviz.updateQuickFilter();">
                                <input type="text" placeholder="Search..." id="dataFilter" class="form-control" />
                                <input type="submit" style="position:absolute;left:-9999px;width:1px;height:1px;" />
                            </form>
                        </div>
                        <!-- <div class="text-right" style="text-align:right;margin:20px;">-->
                        <div class="offset-md-4 col-md-5 text-right">
                            <small class="text-muted">{{roviz.countCurrentPlot()}} results selected &nbsp;</small>
                            <button class="btn btn-success" ng-click="roviz.addPlot()">
                                <i class="fe fe-trending-up"></i>
                                Add Plot
                            </button> 
                            <button class="btn btn-light" data-toggle="modal" data-target="#analysisModal">
                                <i class="fa fa-magic"></i>
                                Add Analysis
                            </button> 
                        </div>
                        </div>
                    </div>

                    <div style="display:block; height:100vh;" class="col-md-12 card">
                        <div ag-grid="gridOptions" class="ag-theme-material" style="height:100%;"></div>
                    </div>

                </div>

                <!-- Analysis Plot Modal -->
                <div class="modal fade bd-example-modal-lg" id="analysisModal">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">

                            <!-- Modal Header -->
                            <div class="modal-header">
                                <h4 class="modal-title">Automatic Analysis</h4>
                                <button type="button" class="close" data-dismiss="modal"></button>
                            </div>
                            <!-- Modal body -->
                            <div class="modal-body">
                                <p>
                                Unfortunately, this functionality is not available yet.
                                When it will be, it will allow users to automagically create common predefined --- and in the future custom --- analysis from their data.
                                </p>
                                <p>If interested, feel free to <a href="https://github.com/seba-1511/randopt" target="_blank">get in touch</a> !</p>
                            </div>

                            <!-- Modal footer -->
                            <div class="modal-footer">
                                <button type="button" class="btn btn-error" data-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-success" data-dismiss="modal">Create</button>
                            </div>

                        </div>
                    </div>
                </div>


                <!-- Edit Plot Modal -->
                <div class="modal fade bd-example-modal-lg" id="editModal">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">

                            <!-- Modal Header -->
                            <div class="modal-header">
                                <h4 class="modal-title">Edit Plot</h4>
                                <button type="button" class="close" data-dismiss="modal"></button>
                            </div>
                            <div class="selectgroup">
                                <label class="selectgroup-item">
                                    <input name="editView" value="1" class="selectgroup-input" checked="" type="radio">
                                    <span class="selectgroup-button selectgroup-button-icon"><i class="fe fe-edit"></i></span>
                                </label>
                                <label class="selectgroup-item">
                                    <input name="editView" value="6" class="selectgroup-input" type="radio">
                                    <span class="selectgroup-button selectgroup-button-icon"><i class="fe fe-eye"></i></span>
                                </label>
                            </div>
                            <!-- Modal body -->
                            <div class="modal-body">
                                <p>
                                Here, you can modify the data and layout that we'll use to generate the Plotly plot.
                                </p>
                                <p>
                                For more information, please refer to the <a href="https://plot.ly/javascript/">plotly.js Documentation</a>.
                                </p>

                                <h4>Plot Data</h4>
                                <center>
                                    <textarea rows="10" cols="70" class="code" ng-model="plotToEdit.data"></textarea>
                                </center>

                                <h4>Plot Layout</h4>
                                <center>
                                    <textarea rows="10" cols="70" class="code" ng-model="plotToEdit.layout"></textarea>
                                </center>

                            </div>

                            <!-- Modal footer -->
                            <div class="modal-footer">
                                <button type="button" class="btn btn-error" data-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-success" data-dismiss="modal" ng-click="roviz.savePlot();">Save</button>
                            </div>

                        </div>
                    </div>
                </div>



                <!-- Plots Page -->
                <!--<div ng-show="page == 'plots'" class="container"> -->
                <div ng-class="{'away': page != 'plots'}" class="container">

                    <br />
                    <div id="plot-container" class="text-left col-md-12">
                        <h3 class="noprint">Plots <small>{{roviz.plots.length}}</small></h3>


                        <div class="row">
                            <div class="col-md-10">
                                <div ng-repeat="plot in roviz.plots" class="card print-plot-width col-md-12" ng-class="{'plot-selected': plot.selected};">
                                    <div class="row">
                                        &nbsp;
                                        &nbsp;
                                        <button class="btn btn-sm btn-warning" style="padding:0px;margin-top:5px;margin-bottom:5px;" data-toggle="modal" data-target="#editModal" ng-click="roviz.editPlot(plot.id);">
                                            <i class="fe fe-code"></i>
                                        </button>
                                        <input ng-model="plot.name" class="print-plot-width col-md-11" style="text-align:center;background-color:white;border:none;font-size:20px;" />
                                        <!--<a href="#" class="col-md-1 btn btn-danger" ng-click="roviz.removePlot(plot.id)">Remove</a> -->
                                        <button type="button" class="btn btn-sm btn-danger" style="padding:1px;margin-top:5px;margin-bottom:5px;" ng-click="roviz.removePlot(plot.id)">
                                            <i class="fe fe-x"></i>
                                        </button>
                                        &nbsp;
                                        &nbsp;
                                    </div>
                                    <div class="print-plot-frame print-plot-width" style="height:450px;border:solid black 2px;">
                                        <plotly-plot plot="plot" page="page" roviz="roviz"></plotly-plot>
                                    </div>
                                    <div class="row noprint">
                                        <div class="offset-md-2 col-sm-4 text-center">
                                            X-axis: 
                                            <select class="form-control" style="display:inline;width:100px;height:30px;padding:0px;background-color:white;background:none;border:solid black 0px;overflow:hidden;" ng-model="plot.xtitle">
                                                <option value="None">List Indices</option>
                                                <option ng-repeat="head in roviz.headers">{{head}}</option>
                                            </select>
                                        </div>
                                        <div class="col-sm-4 text-center">
                                            Y-axis: 
                                            <select class="form-control" style="display:inline;width:100px;height:30px;padding:0px;background-color:white;background:none;border:solid black 0px;overflow:hidden;" ng-model="plot.ytitle">
                                                <option value="None">List Indices</option>
                                                <option ng-repeat="head in roviz.headers">{{head}}</option>
                                            </select>
                                        </div>
                                        <div class="col-sm-2 text-right" style="padding-top:0px;">
                                            <input type="checkbox" ng-model="plot.selected"  />
                                            <a ng-click="plot.selected = !plot.selected" style="text-decoration:none;" class="btn btn-sm btn-default" >Select</a>
                                        </div>
                                    </div>
                                    <div class="print-page-break"></div>
                                </div>
                            </div>

                            <div class="col-md-2 noprint">
                                <div class="cold-md-12 card" style="position:sticky;top:8rem;">
                                    <center>
                                        <small class="text-muted">{{roviz.countSelectedPlots()}} plots selected &nbsp;</small>
                                    </center>
                                    <button style="margin:10px;" class="btn btn-success" ng-click="roviz.averagePlots();">Plot Averages</button> 
                                    <button style="margin:10px;" class="btn btn-success" ng-click="roviz.mergePlots();">Merge Plots</button> 
                                </div>
                            </div>

                        </div>
                    </div>

                </div>

                </div>

                <script type="text/javascript">
                    // Copy up to this line in header.html
var DATA = [{"result": 0.1344860151524397, "dog": 0.10593915866678266, "cat": -0.026496918790483326, "dolphin": 0.3355008541092324, "any_name": 0.1, "sup.data": [0.10593915866678266, -0.026496918790483326, 0.3355008541092324, 0.1]}, {"result": 0.17531902502582764, "dog": 0.16538795437110324, "cat": -0.24530511845480718, "dolphin": 0.2789108252374628, "any_name": 0.1, "sup.data": [0.16538795437110324, -0.24530511845480718, 0.2789108252374628, 0.1]}, {"result": 0.2120266286812968, "dog": -0.24742847353150724, "cat": -0.20951389947310095, "dolphin": 0.3113032365632268, "any_name": 0.1, "sup.data": [-0.24742847353150724, -0.20951389947310095, 0.3113032365632268, 0.1]}, {"result": 0.35030071942710383, "dog": -0.4642731154742313, "cat": -0.1278804128011708, "dolphin": 0.32923820206160326, "any_name": 0.1, "sup.data": [-0.4642731154742313, -0.1278804128011708, 0.32923820206160326, 0.1]}, {"result": 0.42222708929981495, "dog": 0.012404354114906677, "cat": -0.501695757277582, "dolphin": 0.4097250156244801, "any_name": 0.05, "sup.data": [0.012404354114906677, -0.501695757277582, 0.4097250156244801, 0.05]}, {"result": 0.46921835449078453, "dog": 0.20119116396015987, "cat": -0.6338187051801367, "dolphin": 0.15657049210791776, "any_name": 0.05, "sup.data": [0.20119116396015987, -0.6338187051801367, 0.15657049210791776, 0.05]}, {"result": 0.5179736357483383, "dog": -0.42348499853186244, "cat": 0.23163139020723045, "dolphin": 0.18703205831480474, "any_name": 0.5, "sup.data": [-0.42348499853186244, 0.23163139020723045, 0.18703205831480474, 0.5]}, {"result": 0.5467047701367819, "dog": 0.2520872002064513, "cat": -0.2276329433283435, "dolphin": 0.6491071227005059, "any_name": 0.1, "sup.data": [0.2520872002064513, -0.2276329433283435, 0.6491071227005059, 0.1]}, {"result": 0.5623899484228319, "dog": -0.37749962752027333, "cat": -0.46082899236110353, "dolphin": 0.4527920267013729, "any_name": 0.05, "sup.data": [-0.37749962752027333, -0.46082899236110353, 0.4527920267013729, 0.05]}, {"result": 0.8418052912502776, "dog": -0.07991938789518833, "cat": -0.8708754380456278, "dolphin": 0.2772979518452522, "any_name": 0.01, "sup.data": [-0.07991938789518833, -0.8708754380456278, 0.2772979518452522, 0.01]}, {"result": 0.8676007801631012, "dog": -0.3689083984573075, "cat": -0.8321235463258321, "dolphin": 0.19742790421033787, "any_name": 0.01, "sup.data": [-0.3689083984573075, -0.8321235463258321, 0.19742790421033787, 0.01]}, {"result": 0.8712990726363729, "dog": 0.4500346665618601, "cat": -0.7711740606226247, "dolphin": 0.27195301019062196, "any_name": 0.01, "sup.data": [0.4500346665618601, -0.7711740606226247, 0.27195301019062196, 0.01]}, {"result": 0.8751976300645685, "dog": -0.5438040620705854, "cat": -0.6856608304319649, "dolphin": 0.3305207977593055, "any_name": 0.01, "sup.data": [-0.5438040620705854, -0.6856608304319649, 0.3305207977593055, 0.01]}, {"result": 0.8926501404769069, "dog": -0.3314565711346405, "cat": 0.44025595968201237, "dolphin": 0.31458126437066203, "any_name": 0.7, "sup.data": [-0.3314565711346405, 0.44025595968201237, 0.31458126437066203, 0.7]}, {"result": 0.917420584802071, "dog": 0.6567425490859827, "cat": -0.6719935525160776, "dolphin": 0.18556528338818723, "any_name": 0.01, "sup.data": [0.6567425490859827, -0.6719935525160776, 0.18556528338818723, 0.01]}, {"result": 0.9399187398514166, "dog": -0.19811499390451837, "cat": 0.3431269629759701, "dolphin": 0.5412329224285202, "any_name": 0.7, "sup.data": [-0.19811499390451837, 0.3431269629759701, 0.5412329224285202, 0.7]}, {"result": 0.9526489416327575, "dog": 0.23150165159001218, "cat": 0.5657805790448072, "dolphin": 0.29824195432496914, "any_name": 0.7, "sup.data": [0.23150165159001218, 0.5657805790448072, 0.29824195432496914, 0.7]}, {"result": 0.9566372885379762, "dog": 0.14409495042326753, "cat": 0.01620385155958437, "dolphin": 0.8280165270060298, "any_name": 0.5, "sup.data": [0.14409495042326753, 0.01620385155958437, 0.8280165270060298, 0.5]}, {"result": 0.9677509388358219, "dog": -0.5356013986972206, "cat": -0.300815396072615, "dolphin": 0.7618347445706836, "any_name": 0.1, "sup.data": [-0.5356013986972206, -0.300815396072615, 0.7618347445706836, 0.1]}, {"result": 1.0678950434982821, "dog": -0.9592601501987155, "cat": -0.05434614930518733, "dolphin": 0.3670987657221395, "any_name": 0.1, "sup.data": [-0.9592601501987155, -0.05434614930518733, 0.3670987657221395, 0.1]}, {"result": 1.0935659020498492, "dog": 0.2172363060691118, "cat": 0.6130250102312076, "dolphin": 0.42494073258082027, "any_name": 0.7, "sup.data": [0.2172363060691118, 0.6130250102312076, 0.42494073258082027, 0.7]}, {"result": 1.1300589402266608, "dog": -0.2568811022587233, "cat": -0.8221423400186754, "dolphin": 0.6229390116838252, "any_name": 0.01, "sup.data": [-0.2568811022587233, -0.8221423400186754, 0.6229390116838252, 0.01]}, {"result": 1.2823260249629431, "dog": -1.0390948922374894, "cat": -0.04813018373654354, "dolphin": 0.43622392793425474, "any_name": 0.1, "sup.data": [-1.0390948922374894, -0.04813018373654354, 0.43622392793425474, 0.1]}, {"result": 1.3243382180558176, "dog": 0.5390833969382259, "cat": -0.7175444711670009, "dolphin": 0.720248041371186, "any_name": 0.01, "sup.data": [0.5390833969382259, -0.7175444711670009, 0.720248041371186, 0.01]}, {"result": 1.345902384745858, "dog": 0.6457379859067233, "cat": 0.562127195584962, "dolphin": 0.3506249481807766, "any_name": 0.7, "sup.data": [0.6457379859067233, 0.562127195584962, 0.3506249481807766, 0.7]}, {"result": 1.4113258994208118, "dog": -0.7942225348660087, "cat": 0.3127832450788366, "dolphin": 0.6578017225044153, "any_name": 0.5, "sup.data": [-0.7942225348660087, 0.3127832450788366, 0.6578017225044153, 0.5]}, {"result": 1.446972031332733, "dog": -0.4328950809738664, "cat": -0.46133926552636373, "dolphin": 1.021880600796863, "any_name": 0.05, "sup.data": [-0.4328950809738664, -0.46133926552636373, 1.021880600796863, 0.05]}, {"result": 1.487899734863002, "dog": 0.44431594753177583, "cat": 0.17505701626213876, "dolphin": 1.0049070179321764, "any_name": 0.5, "sup.data": [0.44431594753177583, 0.17505701626213876, 1.0049070179321764, 0.5]}, {"result": 1.4973925793677318, "dog": -0.3772271902814042, "cat": -0.7028907225834249, "dolphin": 0.9278668322481841, "any_name": 0.01, "sup.data": [-0.3772271902814042, -0.7028907225834249, 0.9278668322481841, 0.01]}, {"result": 1.5040131058713706, "dog": 0.46104291278843845, "cat": 0.6329261134284607, "dolphin": 0.6331327454643821, "any_name": 0.7, "sup.data": [0.46104291278843845, 0.6329261134284607, 0.6331327454643821, 0.7]}, {"result": 1.533687426845885, "dog": 0.020230708184767448, "cat": -0.7124631448088092, "dolphin": 1.0127064789865667, "any_name": 0.01, "sup.data": [0.020230708184767448, -0.7124631448088092, 1.0127064789865667, 0.01]}, {"result": 1.549744785544138, "dog": 0.2150724549769242, "cat": 0.6198811674624056, "dolphin": 0.7932439491605227, "any_name": 0.7, "sup.data": [0.2150724549769242, 0.6198811674624056, 0.7932439491605227, 0.7]}, {"result": 1.6336450293739313, "dog": -0.9302412877080083, "cat": -0.03792725726696311, "dolphin": 0.869975688840489, "any_name": 0.1, "sup.data": [-0.9302412877080083, -0.03792725726696311, 0.869975688840489, 0.1]}, {"result": 1.6380927613831415, "dog": -0.7933015653304946, "cat": -0.3078220688057538, "dolphin": 0.9507949104741118, "any_name": 0.1, "sup.data": [-0.7933015653304946, -0.3078220688057538, 0.9507949104741118, 0.1]}, {"result": 1.696238924016195, "dog": -1.1042356314216943, "cat": -0.05831974938230977, "dolphin": 0.6808093721056663, "any_name": 0.1, "sup.data": [-1.1042356314216943, -0.05831974938230977, 0.6808093721056663, 0.1]}, {"result": 1.753505521284474, "dog": 0.5567939836959213, "cat": -0.9884395251645137, "dolphin": 0.6829152847147666, "any_name": 0.01, "sup.data": [0.5567939836959213, -0.9884395251645137, 0.6829152847147666, 0.01]}, {"result": 1.7704781817050337, "dog": -0.36184396004826647, "cat": -0.10665867148810482, "dolphin": 1.2720735269936305, "any_name": 0.1, "sup.data": [-0.36184396004826647, -0.10665867148810482, 1.2720735269936305, 0.1]}, {"result": 1.7840686185791237, "dog": -1.1909307655492865, "cat": 0.28208606230338096, "dolphin": 0.1902103669663859, "any_name": 0.5, "sup.data": [-1.1909307655492865, 0.28208606230338096, 0.1902103669663859, 0.5]}, {"result": 1.8698337307748387, "dog": 0.9552856361808956, "cat": -0.917874387456385, "dolphin": 0.33862913774934716, "any_name": 0.01, "sup.data": [0.9552856361808956, -0.917874387456385, 0.33862913774934716, 0.01]}, {"result": 1.8859388839683198, "dog": -1.0828570598554803, "cat": 0.0821763711022605, "dolphin": 0.6757266576966814, "any_name": 0.5, "sup.data": [-1.0828570598554803, 0.0821763711022605, 0.6757266576966814, 0.5]}, {"result": 1.93360024439901, "dog": 0.1913207099950246, "cat": -0.9045294091920291, "dolphin": 1.038615991708547, "any_name": 0.01, "sup.data": [0.1913207099950246, -0.9045294091920291, 1.038615991708547, 0.01]}, {"result": 2.048586681841848, "dog": 1.0694388367436392, "cat": -0.690897199821914, "dolphin": 0.6537953162760484, "any_name": 0.01, "sup.data": [1.0694388367436392, -0.690897199821914, 0.6537953162760484, 0.01]}, {"result": 2.0818860286183956, "dog": 0.07599437119158767, "cat": 0.5329618655835926, "dolphin": 1.1410795476211322, "any_name": 0.7, "sup.data": [0.07599437119158767, 0.5329618655835926, 1.1410795476211322, 0.7]}, {"result": 2.1138458806764193, "dog": -0.4920126767507134, "cat": 0.16445514611789824, "dolphin": 1.2628237848204944, "any_name": 0.5, "sup.data": [-0.4920126767507134, 0.16445514611789824, 1.2628237848204944, 0.5]}, {"result": 2.157874287576734, "dog": 0.3296489194417435, "cat": 0.5419599430395499, "dolphin": 1.1249379083434752, "any_name": 0.7, "sup.data": [0.3296489194417435, 0.5419599430395499, 1.1249379083434752, 0.7]}, {"result": 2.2796661339144437, "dog": -0.7312460531086856, "cat": -0.5263804492737645, "dolphin": 1.21052425268962, "any_name": 0.05, "sup.data": [-0.7312460531086856, -0.5263804492737645, 1.21052425268962, 0.05]}, {"result": 2.345472879396933, "dog": 1.1502984845294577, "cat": 0.24656295007833706, "dolphin": 0.8435004371871028, "any_name": 0.5, "sup.data": [1.1502984845294577, 0.24656295007833706, 0.8435004371871028, 0.5]}, {"result": 2.404105374433869, "dog": -0.4994290508627922, "cat": 0.2892684683565654, "dolphin": 1.3494442377522704, "any_name": 0.5, "sup.data": [-0.4994290508627922, 0.2892684683565654, 1.3494442377522704, 0.5]}, {"result": 2.435209536554824, "dog": 1.1501162307205914, "cat": -0.9707624390261818, "dolphin": 0.41226505959615606, "any_name": 0.01, "sup.data": [1.1501162307205914, -0.9707624390261818, 0.41226505959615606, 0.01]}, {"result": 2.450288282786548, "dog": 0.4499245508870872, "cat": -0.6287562785100229, "dolphin": 1.3601550365784878, "any_name": 0.05, "sup.data": [0.4499245508870872, -0.6287562785100229, 1.3601550365784878, 0.05]}, {"result": 2.5019971028650363, "dog": 0.84819063309384, "cat": 0.6346880137162836, "dolphin": 0.9432607688448544, "any_name": 0.7, "sup.data": [0.84819063309384, 0.6346880137162836, 0.9432607688448544, 0.7]}, {"result": 2.552459988873337, "dog": 1.254495799595116, "cat": -0.8916496027077143, "dolphin": 0.4284405018934631, "any_name": 0.01, "sup.data": [1.254495799595116, -0.8916496027077143, 0.4284405018934631, 0.01]}, {"result": 2.623834856253674, "dog": 0.17132205810768153, "cat": 0.635468003403608, "dolphin": 1.3040950982614936, "any_name": 0.7, "sup.data": [0.17132205810768153, 0.635468003403608, 1.3040950982614936, 0.7]}, {"result": 2.650968286374818, "dog": 1.0947838654426025, "cat": 0.11466047488293629, "dolphin": 1.0905363587891013, "any_name": 0.5, "sup.data": [1.0947838654426025, 0.11466047488293629, 1.0905363587891013, 0.5]}, {"result": 2.663034587298402, "dog": 0.3392866258012423, "cat": 0.577545434472567, "dolphin": 1.3131490562653974, "any_name": 0.7, "sup.data": [0.3392866258012423, 0.577545434472567, 1.3131490562653974, 0.7]}, {"result": 2.6806871167192483, "dog": 1.4512805432247062, "cat": -0.7115085567961834, "dolphin": 0.2610124042693406, "any_name": 0.01, "sup.data": [1.4512805432247062, -0.7115085567961834, 0.2610124042693406, 0.01]}, {"result": 2.846336698806888, "dog": -0.8782568977430044, "cat": -0.3093021495914796, "dolphin": 1.4033295053663668, "any_name": 0.1, "sup.data": [-0.8782568977430044, -0.3093021495914796, 1.4033295053663668, 0.1]}, {"result": 2.861989623815453, "dog": -1.3489944442044972, "cat": 0.11286512111243119, "dolphin": 0.8828731946078828, "any_name": 0.5, "sup.data": [-1.3489944442044972, 0.11286512111243119, 0.8828731946078828, 0.5]}, {"result": 2.97166623861417, "dog": -1.6189411471684878, "cat": -0.1208072046407207, "dolphin": 0.571052904664573, "any_name": 0.1, "sup.data": [-1.6189411471684878, -0.1208072046407207, 0.571052904664573, 0.1]}, {"result": 3.067326258279975, "dog": 0.19819476842730915, "cat": -0.44643261041661586, "dolphin": 1.6811433658093013, "any_name": 0.05, "sup.data": [0.19819476842730915, -0.44643261041661586, 1.6811433658093013, 0.05]}, {"result": 3.143858550822723, "dog": 1.182456826105767, "cat": -0.9614008673805663, "dolphin": 0.9062354977700294, "any_name": 0.01, "sup.data": [1.182456826105767, -0.9614008673805663, 0.9062354977700294, 0.01]}, {"result": 3.3315472701703053, "dog": 1.2261975296244925, "cat": 0.878537994727528, "dolphin": 0.49614300391442684, "any_name": 0.9, "sup.data": [1.2261975296244925, 0.878537994727528, 0.49614300391442684, 0.9]}, {"result": 3.5475548880184538, "dog": -0.5858671686401694, "cat": -0.645313929443492, "dolphin": 1.668947117554719, "any_name": 0.05, "sup.data": [-0.5858671686401694, -0.645313929443492, 1.668947117554719, 0.05]}, {"result": 3.5826120601418747, "dog": -1.8371785465715724, "cat": -0.029597694027130306, "dolphin": 0.4432956402529987, "any_name": 0.1, "sup.data": [-1.8371785465715724, -0.029597694027130306, 0.4432956402529987, 0.1]}, {"result": 3.853729844658395, "dog": 1.5641298523045737, "cat": 0.6677785883024636, "dolphin": 0.3889722442448, "any_name": 0.9, "sup.data": [1.5641298523045737, 0.6677785883024636, 0.3889722442448, 0.9]}, {"result": 3.951620932397369, "dog": -1.7451792696893282, "cat": 0.5871247915475044, "dolphin": 0.26693581287322876, "any_name": 0.7, "sup.data": [-1.7451792696893282, 0.5871247915475044, 0.26693581287322876, 0.7]}, {"result": 4.046255461143632, "dog": 1.5836696791018956, "cat": 0.680958330388985, "dolphin": 0.51433603889945, "any_name": 0.9, "sup.data": [1.5836696791018956, 0.680958330388985, 0.51433603889945, 0.9]}, {"result": 4.564912126825942, "dog": 0.11136763883746918, "cat": -0.2895217051140333, "dolphin": 2.1115602189171807, "any_name": 0.1, "sup.data": [0.11136763883746918, -0.2895217051140333, 2.1115602189171807, 0.1]}, {"result": 4.809837880453976, "dog": 0.1034917897273693, "cat": 0.8219519248982483, "dolphin": 1.820308315387552, "any_name": 0.9, "sup.data": [0.1034917897273693, 0.8219519248982483, 1.820308315387552, 0.9]}, {"result": 5.034156481808239, "dog": 1.8527812735001499, "cat": 0.8746141693924494, "dolphin": 0.16250565858873428, "any_name": 0.9, "sup.data": [1.8527812735001499, 0.8746141693924494, 0.16250565858873428, 0.9]}, {"result": 5.324507102915632, "dog": 1.7304697908468525, "cat": -0.9383719565467801, "dolphin": 1.2038851594104196, "any_name": 0.01, "sup.data": [1.7304697908468525, -0.9383719565467801, 1.2038851594104196, 0.01]}, {"result": 5.392416442082794, "dog": 0.3565028927584915, "cat": 0.9298031218324314, "dolphin": 1.894937540967587, "any_name": 0.9, "sup.data": [0.3565028927584915, 0.9298031218324314, 1.894937540967587, 0.9]}, {"result": 5.393917429415354, "dog": -0.6969793664130848, "cat": 0.158005372374733, "dolphin": 2.152480312223666, "any_name": 0.5, "sup.data": [-0.6969793664130848, 0.158005372374733, 2.152480312223666, 0.5]}, {"result": 5.839915490139749, "dog": -1.88345387994127, "cat": 0.7631351973112128, "dolphin": 0.9487579474759096, "any_name": 0.9, "sup.data": [-1.88345387994127, 0.7631351973112128, 0.9487579474759096, 0.9]}, {"result": 6.031863383985003, "dog": 0.27119256301352784, "cat": -0.9240108099670472, "dolphin": 2.2592967934326817, "any_name": 0.01, "sup.data": [0.27119256301352784, -0.9240108099670472, 2.2592967934326817, 0.01]}, {"result": 6.222135005700022, "dog": -0.7689596126335602, "cat": -0.40864216871498527, "dolphin": 2.3369526520206567, "any_name": 0.05, "sup.data": [-0.7689596126335602, -0.40864216871498527, 2.3369526520206567, 0.05]}, {"result": 6.234329150708886, "dog": -0.06264992784193427, "cat": -0.4277329921215449, "dolphin": 2.4586477227738497, "any_name": 0.05, "sup.data": [-0.06264992784193427, -0.4277329921215449, 2.4586477227738497, 0.05]}, {"result": 6.263214856757793, "dog": -1.84785256367985, "cat": 0.05959828351576624, "dolphin": 1.6109325883666188, "any_name": 0.5, "sup.data": [-1.84785256367985, 0.05959828351576624, 1.6109325883666188, 0.5]}, {"result": 6.671906409955797, "dog": -0.34681496932144434, "cat": 0.20292689912210293, "dolphin": 2.502088419825137, "any_name": 0.5, "sup.data": [-0.34681496932144434, 0.20292689912210293, 2.502088419825137, 0.5]}, {"result": 6.700756193183221, "dog": 0.7802644950576452, "cat": -0.9208207515440767, "dolphin": 2.289963461381308, "any_name": 0.01, "sup.data": [0.7802644950576452, -0.9208207515440767, 2.289963461381308, 0.01]}, {"result": 6.700966086592678, "dog": 0.7411773514130557, "cat": -0.31658441449909236, "dolphin": 2.457925248831069, "any_name": 0.1, "sup.data": [0.7411773514130557, -0.31658441449909236, 2.457925248831069, 0.1]}, {"result": 6.777514220761351, "dog": 1.2862409494919753, "cat": 0.40531789809664964, "dolphin": 2.1139573889021146, "any_name": 0.7, "sup.data": [1.2862409494919753, 0.40531789809664964, 2.1139573889021146, 0.7]}, {"result": 7.6987276805055975, "dog": 2.1970405483761803, "cat": -0.9850170598828256, "dolphin": 1.3789060522879304, "any_name": 0.01, "sup.data": [2.1970405483761803, -0.9850170598828256, 1.3789060522879304, 0.01]}, {"result": 7.968026175484267, "dog": 0.6634678358236119, "cat": 0.8159812382311016, "dolphin": 2.4600835809310704, "any_name": 0.9, "sup.data": [0.6634678358236119, 0.8159812382311016, 2.4600835809310704, 0.9]}, {"result": 8.036182479463731, "dog": -0.2859363132571751, "cat": -0.06820288198338087, "dolphin": 2.81775997400662, "any_name": 0.1, "sup.data": [-0.2859363132571751, -0.06820288198338087, 2.81775997400662, 0.1]}, {"result": 8.196074778878758, "dog": -1.1767807069691938, "cat": -0.09322396104701292, "dolphin": 2.606256173070972, "any_name": 0.1, "sup.data": [-1.1767807069691938, -0.09322396104701292, 2.606256173070972, 0.1]}, {"result": 8.411231471268836, "dog": 0.12599720794372996, "cat": -0.8584522295222865, "dolphin": 2.767366246901092, "any_name": 0.01, "sup.data": [0.12599720794372996, -0.8584522295222865, 2.767366246901092, 0.01]}, {"result": 8.438158315773329, "dog": 1.40396327888095, "cat": -0.6908589705784207, "dolphin": 2.447378048054388, "any_name": 0.01, "sup.data": [1.40396327888095, -0.6908589705784207, 2.447378048054388, 0.01]}, {"result": 9.775863513849947, "dog": -0.35008040277368796, "cat": 0.6588423228348848, "dolphin": 2.9545277150646756, "any_name": 0.7, "sup.data": [-0.35008040277368796, 0.6588423228348848, 2.9545277150646756, 0.7]}, {"result": 10.514682994997058, "dog": 2.328394072209139, "cat": 0.8670309960846934, "dolphin": 1.8792342300327505, "any_name": 0.9, "sup.data": [2.328394072209139, 0.8670309960846934, 1.8792342300327505, 0.9]}, {"result": 10.957117718007366, "dog": 2.053924883121816, "cat": 0.9094373114047898, "dolphin": 2.2586354440513916, "any_name": 0.9, "sup.data": [2.053924883121816, 0.9094373114047898, 2.2586354440513916, 0.9]}, {"result": 15.827010428287359, "dog": -2.4862288198239426, "cat": 0.9138662446988108, "dolphin": 2.8285199611394467, "any_name": 0.9, "sup.data": [-2.4862288198239426, 0.9138662446988108, 2.8285199611394467, 0.9]}, {"result": 16.13179107252051, "dog": 0.33127480475800747, "cat": 0.6294823205153948, "dolphin": 3.8904755601869048, "any_name": 0.7, "sup.data": [0.33127480475800747, 0.6294823205153948, 3.8904755601869048, 0.7]}, {"result": 20.282070348132603, "dog": 1.0542196419272387, "cat": 0.9329070713842775, "dolphin": 4.182149649506653, "any_name": 0.9, "sup.data": [1.0542196419272387, 0.9329070713842775, 4.182149649506653, 0.9]}, {"result": 29.86892546119154, "dog": 0.19724894118707711, "cat": -0.7610651859775761, "dolphin": 5.408391452094147, "any_name": 0.01, "sup.data": [0.19724894118707711, -0.7610651859775761, 5.408391452094147, 0.01]}, {"result": 30.51622080013434, "dog": 1.0784951676246186, "cat": -0.6903070085059675, "dolphin": 5.373680787649396, "any_name": 0.01, "sup.data": [1.0784951676246186, -0.6903070085059675, 5.373680787649396, 0.01]}, {"result": 36.952413093034195, "dog": -0.22555725575068641, "cat": -0.11853480164929464, "dolphin": 6.072683633963685, "any_name": 0.1, "sup.data": [-0.22555725575068641, -0.11853480164929464, 6.072683633963685, 0.1]}, {"result": 39.18628901999726, "dog": 0.35484988486736313, "cat": 0.0603224138231806, "dolphin": 6.229504939045913, "any_name": 0.5, "sup.data": [0.35484988486736313, 0.0603224138231806, 6.229504939045913, 0.5]}, {"result": 44.03697772898944, "dog": 0.4563209957085182, "cat": -0.7522466513861881, "dolphin": 6.577444325370097, "any_name": 0.01, "sup.data": [0.4563209957085182, -0.7522466513861881, 6.577444325370097, 0.01]}, {"result": 306.181350197979, "dog": 0.6619715803353036, "cat": -0.3892145834246028, "dolphin": 17.481108541304152, "any_name": 0.05, "sup.data": [0.6619715803353036, -0.3892145834246028, 17.481108541304152, 0.05]}];// Copy from this line to end in footer.html
                </script>
                <script type="text/javascript">

                    agGrid.initialiseAgGridWithAngular1(angular);

var rovizApp = angular.module('rovizApp', ['ngRoute', 'agGrid'])
    .controller('RovizController', function($scope) {

        $scope.page = 'data'
        this.plotsCreated = 0;

        // Table Control
        this.data = DATA;
        this.headers = ['result'];
        for (var key in this.data[0]) {
            if (key !== 'result') {
                this.headers.push(key);
            }
        }
        for (var i=0; i < this.data.length; i++) {
            this.data[i].__idx = i;
            this.data[i].__name = 'Result ' + i;
        }

        var columnDefs = [
            {headerCheckboxSelection: true, checkboxSelection: true},
            {headerName: 'id', field: '__idx'},
            {headerName: 'result', field: 'result'},
        ];

        for (var key in this.data[0]) {
            if (key !== 'result' && !key.startsWith('__')) {
                columnDefs.push({headerName: key, field: key})
            }
        }

        $scope.gridOptions = {
            enableFilter: true,
            enableSorting: true,
            columnDefs: columnDefs,
            rowData: this.data,
            enableColResize: true,
            rowMultiSelectWithClick: true,
            rowDeselection: true,
            suppressRowClickSelection: false,
            rowSelection: 'multiple',
            onGridReady: function(params) {
                params.api.sizeColumnsToFit();
            },
        };

        this.updateQuickFilter = function() {
            var value = document.getElementById('dataFilter').value;
            $scope.gridOptions.api.setQuickFilter(value);
        };

        this.addPlot = function() {
            $scope.page = 'plots';
            var currentPlot = {
                summaries: $scope.gridOptions.api.getSelectedRows(),
                id: this.plotsCreated,
                xtitle: 'None',
                ytitle: 'result',
                name: 'Plot ' + this.plotsCreated,
                selected: false,
                layout: {},
                data: {},
                custom: false,
                num_updates: 0,
            };
            this.plots.push(currentPlot);
            this.plotsCreated++;
            $scope.plotToEdit = {
                data: {},
                layout: {},
                plot: currentPlot,
                showPrev: false,

            };
            this.saveState();
        };

        this.countCurrentPlot = function() {
            return $scope.gridOptions.api.getSelectedRows().length;
        };

        // Keyboard Shortcuts

        var shiftDown = false;
        angular.element(document).bind('keydown', function(event) {
            if (event.which == 16) { // 16 == Shift
                shiftDown = true;
            } 
            if (shiftDown && event.which == 222) { // 222 == ?
                $scope.page = 'home';
                $scope.$apply();
            }
            if (shiftDown && event.which == 68) { // 68 == d
                $scope.page = 'data';
                $scope.$apply();
            }
            if (shiftDown && event.which == 80) { // 80 == p
                $scope.page = 'plots';
                $scope.$apply();
            }
            if (shiftDown && event.which == 72) { // 72 == h
                switch($scope.page) {
                    case 'home':
                        $scope.page = 'plots';
                        break;
                    case 'data':
                        $scope.page = 'home';
                        break;
                    case 'plots':
                        $scope.page = 'data';
                        break;
                }
                $scope.$apply();
            }
            if (shiftDown && event.which == 76) { // 76 == l
                switch($scope.page) {
                    case 'home':
                        $scope.page = 'data';
                        break;
                    case 'data':
                        $scope.page = 'plots';
                        break;
                    case 'plots':
                        $scope.page = 'home';
                        break;
                }
                $scope.$apply();
            }
            if (event.which == 74) { // 74 == j
                window.scrollBy(0, 500);
            }
            if (event.which == 75) { // 75 == k
                window.scrollBy(0, -500);
            }
            if (event.which == 70) { // 70 == f
                var elem = document.documentElement;

                if (document.fullscreenElement) {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                    } else if (document.mozCancelFullScreen) { /* Firefox */
                        document.mozCancelFullScreen();
                    } else if (document.webkitExitFullscreen) { /* Chrome, Safari and Opera */
                        document.webkitExitFullscreen();
                    } else if (document.msExitFullscreen) { /* IE/Edge */
                        document.msExitFullscreen();
                    }
                }
                else {
                    if (elem.requestFullscreen) {
                        elem.requestFullscreen();
                    }
                    else if (elem.mozRequestFullScreen) { /* Firefox */
                        elem.mozRequestFullScreen();
                    } else if (elem.webkitRequestFullscreen) { /* Chrome, Safari and Opera */
                        elem.webkitRequestFullscreen();
                    } else if (elem.msRequestFullscreen) { /* IE/Edge */
                        elem.msRequestFullscreen();
                    }
                }

            }
        });
        angular.element(document).bind('keyup', function(event) {
            if (event.which == 16) { // 16 == Shift
                shiftDown = false;
            } 
        });

        // Plot Control
        this.plots = [];
        $scope.plotToEdit = {};

        if (window.localStorage[window.location.href] !== null && typeof(window.localStorage[window.location.href]) !== 'undefined') {
            this.plots = JSON.parse(window.localStorage.getItem(window.location.href));
        }


        this.editPlot = function(id) {
            var i, plotToEdit, dataContent, layoutContent;
            for (i=0; i < this.plots.length; i++) {
                if (this.plots[i].id == id) {
                    plotToEdit = this.plots[i];
                    break;
                }
            }
            $scope.plotToEdit.plot = plotToEdit;
            $scope.plotToEdit.layout = JSON.stringify(plotToEdit.layout, null, 4);
            $scope.plotToEdit.data = JSON.stringify(plotToEdit.data, null, 4);
        };

        this.savePlot = function(id) {
            var data, layout;
            data = $scope.plotToEdit.data.replace(/'/g, '"');
            layout = $scope.plotToEdit.layout.replace(/'/g, '"');
            try {
                data = JSON.parse($scope.plotToEdit.data);
            }
            catch (err) {
                data = eval($scope.plotToEdit.data);        
            }
            try {
                layout = JSON.parse($scope.plotToEdit.layout);
            }
            catch (err) {
                layout = eval($scope.plotToEdit.layout);        
            }
            $scope.plotToEdit.plot.data = data;
            $scope.plotToEdit.plot.layout = layout;
            $scope.plotToEdit.plot.custom = true;
            $scope.plotToEdit.plot.num_updates++;
            this.saveState();
        };

        this.removePlot = function(id) {
            var i;
            for (i=0; i < this.plots.length; i++) {
                if (this.plots[i].id == id) {
                    this.plots.splice(i, 1);
                }
            }
            this.saveState();
        };

        this.countSelectedPlots = function() {
            var i, count = 0;
            for (i=0; i < this.plots.length; i++) {
                if (this.plots[i].selected == 1) {
                    count++;
                }
            }
            return count;
        };

        this.mergePlots = function() {
            var i, j, plots = [];
            var currentPlot;
            currentPlot = {
                summaries: [],
                id: this.plotsCreated,
                xtitle: 'None',
                ytitle: 'result',
                name: 'Merge ' + this.plotsCreated,
                selected: false,
                data: {},
                layout: {},
            };
            for (i=0; i < this.plots.length; i++) {
                if (this.plots[i].selected) {
                    for (j=0; j < this.plots[i].data.length; j++) {
                        currentPlot.summaries.push(this.plots[i].data[j]);
                    }
                    this.plots[i].selected = false;
                }
            }
            this.plots.push(currentPlot);
            this.plotsCreated++;
            this.saveState();
        };

        this.averagePlots = function() {
            var i, j, h, plots = [];
            var currentPlot, header, new_data, header_avg, header_data;
            currentPlot = {
                summaries: [],
                id: this.plotsCreated,
                xtitle: 'None',
                ytitle: 'result',
                name: 'Average ' + this.plotsCreated,
                selected: false,
                data: {},
                layout: {},
            };
            for (i=0; i < this.plots.length; i++) {
                if (this.plots[i].selected) {
                    new_data = {};

                    for (h=0; h < this.headers.length; h++) {
                        header = this.headers[h];
                        header_avg = this.plots[i].summaries[0][header];

                        for (j=1; j < this.plots[i].summaries.length; j++) {
                            // For each data (curve), you need to compute the average
                            header_data = this.plots[i].summaries[j][header];
                            if (typeof header_data.map === 'function') {
                                header_avg = header_avg.map(function(num, idx) {
                                    return num + header_data[idx];
                                });
                            }
                            else {
                                header_avg = header_avg + header_data;
                            }
                        }
                        if (typeof header_avg.map === 'function') {
                            thisplots = this.plots;
                            header_avg = header_avg.map(function(num, idx) {
                                return num / thisplots[i].summaries.length;
                            });
                        }
                        else {
                            header_avg = header_avg / this.plots[i].summaries.length;
                        }

                        new_data[header] = header_avg;
                    }

                    new_data.__name = this.plots[i].name;
                    currentPlot.summaries.push(new_data);
                    this.plots[i].selected = false;
                }
            }
            this.plots.push(currentPlot);
            this.plotsCreated++;
            this.saveState();
        };


        this.export = function() {
            var copy, file, html;
            copy = (' ' + CODE).slice(1); // Makes a deep copy
            plots = [];
            for (i=0; i < this.plots.length; i++) { 
                p = Object.assign({}, this.plots[i]); // Deep copy
                delete p['$$hashKey']; // Remove angular annotations
                plots.push(p);
            }
            plot_content = JSON.stringify(plots);
            search = 'this.plots = ';
            start_idx = copy.indexOf(search);
            start = copy.substr(0, start_idx + search.length);
            end = copy.substr(start_idx + search.length + 2);
            content = start + plot_content + end;
            file = "data:text/plain;charset=utf-8," + encodeURIComponent(content);
            window.open(file, 'export');
        };

        this.saveState = function() {
            var copy, file, html;
            copy = (' ' + CODE).slice(1); // Makes a deep copy
            plots = [];
            for (i=0; i < this.plots.length; i++) { 
                p = Object.assign({}, this.plots[i]); // Deep copy
                delete p['$$hashKey']; // Remove angular annotations
                plots.push(p);
            }
            plot_content = JSON.stringify(plots);
            window.localStorage.setItem(window.location.href, plot_content);
        };


        // Enable plugins
    }).directive('plotlyPlot', [function() {

        var xrange = function(N) {
            var i, a = [];
            for (i=0; i < N; i++) {
                a.push(i);
            }
            return a;
        };

        var renderPlot = function(scope, element, attrs) {
            var traces = [];
            var i, data, trace, xdata, ydata;
            if (!scope.plot.custom) {
                for (i=0; i < scope.plot.summaries.length; i++) {
                    data = scope.plot.summaries[i];
                    if (scope.plot.xtitle === 'None') {
                        xdata = xrange(data[scope.plot.ytitle].length);
                    } else {
                        xdata = data[scope.plot.xtitle];
                    }
                    if (scope.plot.ytitle === 'None') {
                        ydata = xrange(data[scope.plot.xtitle].length);
                    } else {
                        ydata = data[scope.plot.ytitle];
                    }
                    if (!Array.isArray(xdata)) {
                        xdata = [xdata, ];
                    }
                    if (!Array.isArray(ydata)) {
                        ydata = [ydata, ];
                    }
                    trace = {
                        x: xdata,
                        y: ydata,
                        type: 'scatter',
                        mode: 'lines+markers',
                        name: data.__name,

                    };
                    traces.push(trace);
                }
                var layout = {
                    xaxis: {title: scope.plot.xtitle, showticklabels: true},
                    yaxis: {title: scope.plot.ytitle, showticklabels: true},
                    width: element[0].parentElement.clientWidth -10,
                    height: element[0].parentElement.clientHeight -10,
                    margin: {l:30, t:0, r:0, b:30},
                    showlegend: true,
                    legend: {x: 0.85, y: 0.95, traceorder: 'normal'}
                };
                scope.plot.layout = layout;
                scope.plot.data = traces;
            }
            scope.roviz.saveState();
            Plotly.newPlot(element[0], scope.plot.data, scope.plot.layout);

        };

        return {
            restrict: 'EACM',
            template: '<div></div>',
            link: function(scope, element, attrs) {
                scope.$watch('plot.xtitle', function(oldVal, newVal) {
                    setTimeout(function(){renderPlot(scope, element, attrs);}, 100)
                });
                scope.$watch('plot.ytitle', function(oldVal, newVal) {
                    setTimeout(function(){renderPlot(scope, element, attrs);}, 100)
                });
                scope.$watch('plot.num_updates', function(oldVal, newVal) {
                    setTimeout(function(){renderPlot(scope, element, attrs);}, 100)
                });
                angular.element(element[0]).bind('resize', function() {
                    setTimeout(function(){renderPlot(scope, element, attrs);}, 100)
                });
            },
        };
    }]);

                </script>
                <script type="text/javascript">
                    var CODE;
                    document.addEventListener("DOMContentLoaded", function(event) {
                        CODE = document.documentElement.outerHTML;
                    });
                </script>
    </body>
</html>
